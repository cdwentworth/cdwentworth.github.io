<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Fitting Models to Data: The Method of Least Squares â€“ Computational Science</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../chapters/Ch11/Ch11_Projects_DynamicalSystems.html" rel="next">
<link href="../../chapters/Ch09/Ch09_StochasticSimulations.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-bde1a9c17d4c5fbad7829061492aca89.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../chapters/Ch10/Ch10_Least-squaresMethodsForData-fitting.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Fitting Models to Data: The Method of Least Squares</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">Computational Science</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../acknowledgements.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Acknowledgements</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/Ch01/Ch01_Introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/Ch02/Ch02_ComputationalThinking.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Computational Thinking and Problem Solving</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/Ch03/Ch03_ControlStructures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Control Structures</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/Ch04/Ch04_Lists.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Lists</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/Ch05/Ch05_PrinciplesOfScientificVisualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Principles of Scientific Visualization</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/Ch06/Ch06_Functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Functions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/Ch07/Ch07_DynamicalSystemsModeling1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Dynamical Systems Modeling I</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/Ch08/Ch08_DynamicalSystemsModelingII.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Dynamical Systems Modeling II</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/Ch09/Ch09_StochasticSimulations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Stochastic Models and Simulations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/Ch10/Ch10_Least-squaresMethodsForData-fitting.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Fitting Models to Data: The Method of Least Squares</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/Ch11/Ch11_Projects_DynamicalSystems.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Project Ideas: Dynamical Systems Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/Ch12/Ch12_Projects_Stochastic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Project Ideas: Stochastic Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../bibliography.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bibliography</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../appendices/AppendixA/AppA_PythonProgrammingEnvironments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Python Programming Environments</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../appendices/AppendixB/AppB_AdvancedPlotting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Advanced Plotting with Matplotlib</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#motivating-problem-damped-spring" id="toc-motivating-problem-damped-spring" class="nav-link active" data-scroll-target="#motivating-problem-damped-spring">Motivating Problem: Damped Spring {</a></li>
  <li><a href="#ch10-introduction:sec" id="toc-ch10-introduction:sec" class="nav-link" data-scroll-target="#ch10-introduction\:sec">Introduction</a></li>
  <li><a href="#the-method-of-least-squares" id="toc-the-method-of-least-squares" class="nav-link" data-scroll-target="#the-method-of-least-squares">The Method of Least Squares</a>
  <ul class="collapse">
  <li><a href="#definition" id="toc-definition" class="nav-link" data-scroll-target="#definition">Definition</a></li>
  <li><a href="#linear-regression" id="toc-linear-regression" class="nav-link" data-scroll-target="#linear-regression">Linear Regression</a></li>
  <li><a href="#non-linear-regression" id="toc-non-linear-regression" class="nav-link" data-scroll-target="#non-linear-regression">Non-linear Regression</a></li>
  </ul></li>
  <li><a href="#computational-problem-solving-damped-spring-best-fit-model-parameter-values:sec" id="toc-computational-problem-solving-damped-spring-best-fit-model-parameter-values:sec" class="nav-link" data-scroll-target="#computational-problem-solving-damped-spring-best-fit-model-parameter-values\:sec">Computational Problem Solving: Damped Spring â€“ Best-fit Model Parameter Values</a>
  <ul class="collapse">
  <li><a href="#analysis-analyze-the-problem" id="toc-analysis-analyze-the-problem" class="nav-link" data-scroll-target="#analysis-analyze-the-problem">Analysis: Analyze the problem</a></li>
  <li><a href="#design-describe-the-data-and-develop-algorithms" id="toc-design-describe-the-data-and-develop-algorithms" class="nav-link" data-scroll-target="#design-describe-the-data-and-develop-algorithms">Design: Describe the data and develop algorithms</a></li>
  <li><a href="#implementation" id="toc-implementation" class="nav-link" data-scroll-target="#implementation">Implementation</a></li>
  <li><a href="#testing" id="toc-testing" class="nav-link" data-scroll-target="#testing">Testing</a></li>
  </ul></li>
  <li><a href="#ch10-exercises:sec" id="toc-ch10-exercises:sec" class="nav-link" data-scroll-target="#ch10-exercises\:sec">Exercises</a></li>
  <li><a href="#program-modification-problems" id="toc-program-modification-problems" class="nav-link" data-scroll-target="#program-modification-problems">Program Modification Problems</a></li>
  <li><a href="#ch10-program-development-problems:sec" id="toc-ch10-program-development-problems:sec" class="nav-link" data-scroll-target="#ch10-program-development-problems\:sec">Program Development Problems</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Fitting Models to Data: The Method of Least Squares</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="motivating-problem-damped-spring" class="level2">
<h2 class="anchored" data-anchor-id="motivating-problem-damped-spring">Motivating Problem: Damped Spring {</h2>
<p><a href="#fig-SpringSetup" class="quarto-xref">Figure&nbsp;<span>1</span></a> shows the setup for a physics experiment involving a mass <em>m</em> (= 0.550 [kg]) attached to a spring. The spring is stretched from rest and released. Position data collected by a motion detector is shown in <a href="#fig-SpringData" class="quarto-xref">Figure&nbsp;<span>2</span></a>. Since the data shows significant damping, the situation will require more than simply the ideal force law (Hookeâ€™s Law: <span class="math inline">\(F=-ky\)</span>) to understand. By adding a drag force proportional to velocity, <span class="math inline">\(-bv_y\)</span>, an appropriate model can be constructed. The solution to Newtonâ€™s 2<sup>nd</sup> Law is discussed in most general physics textbooks and yields <span class="citation" data-cites="Knight_Chapter15Oscillations_2016">(<a href="../../bibliography.html#ref-Knight_Chapter15Oscillations_2016" role="doc-biblioref">Knight, 2016</a>)</span></p>
<p><span id="eq-Equation10_dampedOscillations"><span class="math display">\[\begin{array}{l} y\left(t\right) = Ae^{- bt/ 2m}\cos \left(\omega t + \phi_0\right) \\ \\ \omega  = \sqrt{\omega_0^2- \frac{b^2}{4m^2}}\text{ , }\omega_0 = \sqrt{\frac{k}{m}} \\  \end{array} \tag{1}\]</span></span></p>
<p>In Equation <a href="#eq-Equation10_dampedOscillations" class="quarto-xref">Equation&nbsp;<span>1</span></a>, <span class="math inline">\(y(t)\)</span> is the position measured with respect to the massâ€™s equilibrium position.</p>
<table width="100%" border="0">
<tbody>
<tr>
<td>
<div id="fig-SpringSetup" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-SpringSetup-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../..\chapters/Ch10/Figures/dampedSpringSetup.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-SpringSetup-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Spring experiment setup.
</figcaption>
</figure>
</div>
</td>
<td>
<div id="fig-SpringData" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-SpringData-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../..\chapters/Ch10/Figures/dampedSpringData.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-SpringData-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Data from the spring experiment.
</figcaption>
</figure>
</div>
</td>
</tr>
</tbody>
</table>
<p>Our computational problem will be to choose the best-fit values for the model parameters, <em>A</em>, <em>b</em>, and <em>k</em>, so that the model equation fits the provided data.</p>
</section>
<section id="ch10-introduction:sec" class="level2">
<h2 class="anchored" data-anchor-id="ch10-introduction:sec">Introduction</h2>
<p>In Chapter 7 on dynamical systems, we considered a mathematical model for the growth of bacteria. Our development of the model was guided by some actual data on growth for a couple of different species of bacteria. When we needed to choose values for parameters that appeared in the model, we used a trial-and-error method to choose values that gave a good fit of the model to the available data. We need a more statistically sophisticated method that can choose best-fit values and estimate how much experimental uncertainty the values have.</p>
</section>
<section id="the-method-of-least-squares" class="level2">
<h2 class="anchored" data-anchor-id="the-method-of-least-squares">The Method of Least Squares</h2>
<section id="definition" class="level3">
<h3 class="anchored" data-anchor-id="definition">Definition</h3>
<p>While there are several methods that can be used to statistically estimate best-fit model parameter values, we will use the method of least squares. It is a widely used method and usually a good first-choice for the models we often encounter in science and engineering. We will introduce the basic framework with some formal definitions and then move on to implementing the method computationally, first with simple linear models and then with more complex non-linear models.</p>
<p>Let us assume that we have a model with independent variables <span class="math inline">\(\mathbf x = \left(x_1,x_2,\ldots  ,x_v\right)\)</span>, a set of model parameters <span class="math inline">\(\mathbf p = \left(p_1,p_2,\ldots ,p_m\right)\)</span>, and the model function <span class="math inline">\(f\left(\mathbf x;\mathbf p\right)\)</span> that determines the dependent variable y.</p>
<p><span id="eq-Equation10_modelFunction"><span class="math display">\[y = f\left(\mathbf x;\mathbf p\right) \tag{2}\]</span></span></p>
<p>In the simplest case there will be just one independent variable, but the method works for more complex cases.</p>
<p>Suppose we have performed an experiment that produced <em>n</em> data points</p>
<p><span class="math display">\[\left(\mathbf x_1,y_1\right),\ldots ,\left(\mathbf x_n,y_n\right)\]</span></p>
<p>Next, we define a function called the Least Square Estimator, <span class="math inline">\(L\left(\textbf{p}\right)\)</span>, by the equation</p>
<p><span id="eq-Equation10_LeastSquareEstimator"><span class="math display">\[L\left(\mathbf p\right) = \sum_{i = 1}^n\left(y_i- f\left(\mathbf x_i;\mathbf p\right)\right)^2 \tag{3}\]</span></span></p>
<p>Note that <em>L</em> is a function of the model parameters. The least squares method for data fitting involves choosing the model parameter values <strong>p</strong> that minimize the function <em>L</em>.</p>
</section>
<section id="linear-regression" class="level3">
<h3 class="anchored" data-anchor-id="linear-regression">Linear Regression</h3>
<p>If we are using a simple linear model</p>
<p><span id="eq-Equation10_LinearModel"><span class="math display">\[y=ax+b \tag{4}\]</span></span></p>
<p>then statisticians have derived closed-form formulae for the best-fit slope, <em>a</em>, and intercept, <em>b</em>. They use the calculus principle that necessary conditions for a function to be a minimum are that first partial derivatives with respect to the independent variables must be zero. This is symbolized by</p>
<p><span id="eq-Equation10_MinimizationCondition"><span class="math display">\[\begin{array}{left} \frac{\partial L\left(a,b\right)}{\partial a} = 0 \\ \frac{\partial L\left(a,b\right)}{\partial b} = 0 \\  \end{array} \tag{5}\]</span></span></p>
<p>These equations can be solved for the best-fit values of <em>a</em> and <em>b</em>. We will not work through the calculus or give the explicit formulae. You will learn to do that in a more advanced statistics course <span class="citation" data-cites="Akritas_Chapter6Fitting_2018">(<a href="../../bibliography.html#ref-Akritas_Chapter6Fitting_2018" role="doc-biblioref">Akritas, 2018</a>)</span>. Instead, we will learn how to implement the linear least squares technique numerically, letting the computer do all of the work.</p>
<p>We will use a specific example to learn this technique. Consider a rigid container with some air in it. We measure the pressure of this gas as the temperature is varied. The volume is held constant. <a href="#fig-GasData" class="quarto-xref">Figure&nbsp;<span>3</span></a> shows some of the data from the file GasData.txt.</p>
<div id="fig-GasData" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-GasData-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../..\chapters/Ch10/Figures/GasData.png" class="img-fluid figure-img" style="width:90.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-GasData-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Pressure data as a function of temperature for a fixed volume of gas.
</figcaption>
</figure>
</div>
<p>Visual inspection of the figure suggests that a linear model should fit this data rather well. We will use the method of least squares, linear regression version, to find the best fit slope and intercept. We expect the data presented in <a href="#fig-GasData" class="quarto-xref">Figure&nbsp;<span>3</span></a> to fit the following model equation:</p>
<p><span id="eq-Equation10_P-T"><span class="math display">\[P=aT+b \tag{6}\]</span></span></p>
<p>Minimizing the Least Squares Estimator function involves minimizing the vertical distance between the data points and the theoretical model value. Consider <a href="#fig-GasDataFit" class="quarto-xref">Figure&nbsp;<span>4</span></a>, which shows our data with a linear model drawn as a red line.</p>
<div id="fig-GasDataFit" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-GasDataFit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../..\chapters/Ch10/Figures/GasDataFit.png" class="img-fluid figure-img" style="width:90.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-GasDataFit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Gas data with a linear model.
</figcaption>
</figure>
</div>
<p>The method of least-squares will find the model parameters, the slope and intercept in this case, that will minimize the sum of the squares of the residuals. The model line shown in <a href="#fig-GasDataFit" class="quarto-xref">Figure&nbsp;<span>4</span></a> was produced by the linear regression formulae from the least squares method. It is hard to imagine a different line that would come closer to the data points.</p>
<p>We will make use of a Python library function that will apply the linear regression formulae to the data set and give the user the optimized slope and intercept. The function is from the scipy.stats library. It is the scipy.stats.linregress() function <span class="citation" data-cites="TheSciPyCommunity_ScipystatslinregressSciPyV193_2022">(<a href="../../bibliography.html#ref-TheSciPyCommunity_ScipystatslinregressSciPyV193_2022" role="doc-biblioref">The SciPy Community, 2022b</a>)</span>.</p>
<p>Syntax:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>out <span class="op">=</span> scipy.stats.linregress(x,y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>x = a list with the independent variable values</p>
<p>y = a list with corresponding dependent variable values</p>
<p>The function returns a list-like data structure, called out above, containing the following values (data type in parentheses)</p>
<p>slope : (float) slope of the regression line</p>
<p>intercept : (float) intercept of the regression line</p>
<p>r-value : (float) correlation coefficient</p>
<p>p-value : (float) two-sided p-value for a hypothesis test whose null hypothesis is that the slope is zero.</p>
<p>stderr : (float) Standard error of the slope estimate</p>
<p>The following lines of code will retrieve all of these values from the variable out.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>slope <span class="op">=</span> out[<span class="dv">0</span>]</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>intercept <span class="op">=</span> out[<span class="dv">1</span>]</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>rvalue <span class="op">=</span> out[<span class="dv">2</span>]</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>pvalue <span class="op">=</span> out[<span class="dv">3</span>]</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>se <span class="op">=</span> out[<span class="dv">4</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><a href="#fig-GasDataFitCode" class="quarto-xref">Figure&nbsp;<span>5</span></a> shows a Python script that will apply the linregress function to the gas data. The code produces the following text output.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>slope<span class="op">=</span> <span class="fl">0.0948</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>intercept<span class="op">=</span> <span class="fl">0.8803</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>rvalue<span class="op">=</span> <span class="fl">0.9986</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>pvalue<span class="op">=</span> <span class="fl">1.32e-20</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>se<span class="op">=</span> <span class="fl">0.0013</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><a href="#fig-GasDataFit" class="quarto-xref">Figure&nbsp;<span>4</span></a> shows the graph produced by the code.</p>
<div id="fig-GasDataFitCode" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-GasDataFitCode-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode" id="fig-GasDataFitCode"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="fig-GasDataFitCode-1"><a href="#fig-GasDataFitCode-1" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="fig-GasDataFitCode-2"><a href="#fig-GasDataFitCode-2" aria-hidden="true" tabindex="-1"></a><span class="co">Program: Gas Data Fit</span></span>
<span id="fig-GasDataFitCode-3"><a href="#fig-GasDataFitCode-3" aria-hidden="true" tabindex="-1"></a><span class="co">Author: C.D. Wentworth</span></span>
<span id="fig-GasDataFitCode-4"><a href="#fig-GasDataFitCode-4" aria-hidden="true" tabindex="-1"></a><span class="co">Version: 3-20-2017.1</span></span>
<span id="fig-GasDataFitCode-5"><a href="#fig-GasDataFitCode-5" aria-hidden="true" tabindex="-1"></a><span class="co">Summary:</span></span>
<span id="fig-GasDataFitCode-6"><a href="#fig-GasDataFitCode-6" aria-hidden="true" tabindex="-1"></a><span class="co">    This program reads in pressure-temperature data and fits</span></span>
<span id="fig-GasDataFitCode-7"><a href="#fig-GasDataFitCode-7" aria-hidden="true" tabindex="-1"></a><span class="co">    the data to a linear model using the scipy.stats.linregress()</span></span>
<span id="fig-GasDataFitCode-8"><a href="#fig-GasDataFitCode-8" aria-hidden="true" tabindex="-1"></a><span class="co">    function.</span></span>
<span id="fig-GasDataFitCode-9"><a href="#fig-GasDataFitCode-9" aria-hidden="true" tabindex="-1"></a><span class="co">Version History:</span></span>
<span id="fig-GasDataFitCode-10"><a href="#fig-GasDataFitCode-10" aria-hidden="true" tabindex="-1"></a><span class="co">    3-20-2017.1: Base</span></span>
<span id="fig-GasDataFitCode-11"><a href="#fig-GasDataFitCode-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="fig-GasDataFitCode-12"><a href="#fig-GasDataFitCode-12" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="fig-GasDataFitCode-13"><a href="#fig-GasDataFitCode-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="fig-GasDataFitCode-14"><a href="#fig-GasDataFitCode-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="fig-GasDataFitCode-15"><a href="#fig-GasDataFitCode-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="fig-GasDataFitCode-16"><a href="#fig-GasDataFitCode-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.stats <span class="im">as</span> ss</span>
<span id="fig-GasDataFitCode-17"><a href="#fig-GasDataFitCode-17" aria-hidden="true" tabindex="-1"></a><span class="co"># import data</span></span>
<span id="fig-GasDataFitCode-18"><a href="#fig-GasDataFitCode-18" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> np.loadtxt(<span class="st">'GasData.txt'</span>,  skiprows<span class="op">=</span><span class="dv">3</span>)</span>
<span id="fig-GasDataFitCode-19"><a href="#fig-GasDataFitCode-19" aria-hidden="true" tabindex="-1"></a>tData <span class="op">=</span> cols[:, <span class="dv">0</span>]</span>
<span id="fig-GasDataFitCode-20"><a href="#fig-GasDataFitCode-20" aria-hidden="true" tabindex="-1"></a>PData <span class="op">=</span> cols[:, <span class="dv">1</span>]</span>
<span id="fig-GasDataFitCode-21"><a href="#fig-GasDataFitCode-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit data to linear model</span></span>
<span id="fig-GasDataFitCode-22"><a href="#fig-GasDataFitCode-22" aria-hidden="true" tabindex="-1"></a>out <span class="op">=</span> ss.linregress(tData, PData)</span>
<span id="fig-GasDataFitCode-23"><a href="#fig-GasDataFitCode-23" aria-hidden="true" tabindex="-1"></a>slope <span class="op">=</span> out[<span class="dv">0</span>]</span>
<span id="fig-GasDataFitCode-24"><a href="#fig-GasDataFitCode-24" aria-hidden="true" tabindex="-1"></a>intercept <span class="op">=</span> out[<span class="dv">1</span>]</span>
<span id="fig-GasDataFitCode-25"><a href="#fig-GasDataFitCode-25" aria-hidden="true" tabindex="-1"></a>rvalue <span class="op">=</span> out[<span class="dv">2</span>]</span>
<span id="fig-GasDataFitCode-26"><a href="#fig-GasDataFitCode-26" aria-hidden="true" tabindex="-1"></a>pvalue <span class="op">=</span> out[<span class="dv">3</span>]</span>
<span id="fig-GasDataFitCode-27"><a href="#fig-GasDataFitCode-27" aria-hidden="true" tabindex="-1"></a>se <span class="op">=</span> out[<span class="dv">4</span>]</span>
<span id="fig-GasDataFitCode-28"><a href="#fig-GasDataFitCode-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'slope= '</span>, <span class="bu">format</span>(slope,<span class="st">'7.4f'</span>))</span>
<span id="fig-GasDataFitCode-29"><a href="#fig-GasDataFitCode-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'intercept= '</span>,<span class="bu">format</span>(intercept,<span class="st">'7.4f'</span>))</span>
<span id="fig-GasDataFitCode-30"><a href="#fig-GasDataFitCode-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'rvalue= '</span>,<span class="bu">format</span>(rvalue,<span class="st">'7.4f'</span>))</span>
<span id="fig-GasDataFitCode-31"><a href="#fig-GasDataFitCode-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'pvalue= '</span>,<span class="bu">format</span>(pvalue,<span class="st">'7.2e'</span>))</span>
<span id="fig-GasDataFitCode-32"><a href="#fig-GasDataFitCode-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'se= '</span>,<span class="bu">format</span>(se,<span class="st">'7.4f'</span>))</span>
<span id="fig-GasDataFitCode-33"><a href="#fig-GasDataFitCode-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data</span></span>
<span id="fig-GasDataFitCode-34"><a href="#fig-GasDataFitCode-34" aria-hidden="true" tabindex="-1"></a>plt.plot(tData,PData,linestyle<span class="op">=</span><span class="st">''</span>,marker<span class="op">=</span><span class="st">'d'</span>,label<span class="op">=</span><span class="st">'Data'</span>)</span>
<span id="fig-GasDataFitCode-35"><a href="#fig-GasDataFitCode-35" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'T [K]'</span>)</span>
<span id="fig-GasDataFitCode-36"><a href="#fig-GasDataFitCode-36" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'P [kPa]'</span>)</span>
<span id="fig-GasDataFitCode-37"><a href="#fig-GasDataFitCode-37" aria-hidden="true" tabindex="-1"></a>plt.xlim((<span class="dv">0</span>,<span class="dv">500</span>))</span>
<span id="fig-GasDataFitCode-38"><a href="#fig-GasDataFitCode-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="fig-GasDataFitCode-39"><a href="#fig-GasDataFitCode-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the theory</span></span>
<span id="fig-GasDataFitCode-40"><a href="#fig-GasDataFitCode-40" aria-hidden="true" tabindex="-1"></a>tTheory <span class="op">=</span> np.linspace(<span class="dv">0</span>,<span class="dv">500</span>,<span class="dv">100</span>)</span>
<span id="fig-GasDataFitCode-41"><a href="#fig-GasDataFitCode-41" aria-hidden="true" tabindex="-1"></a>PTheory <span class="op">=</span> slope<span class="op">*</span>tTheory <span class="op">+</span> intercept</span>
<span id="fig-GasDataFitCode-42"><a href="#fig-GasDataFitCode-42" aria-hidden="true" tabindex="-1"></a>plt.plot(tTheory,PTheory,label<span class="op">=</span><span class="st">'Model'</span>)</span>
<span id="fig-GasDataFitCode-43"><a href="#fig-GasDataFitCode-43" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="fig-GasDataFitCode-44"><a href="#fig-GasDataFitCode-44" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'GasData.png'</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-GasDataFitCode-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: :Python code to fit gas data to linear model.
</figcaption>
</figure>
</div>
</section>
<section id="non-linear-regression" class="level3">
<h3 class="anchored" data-anchor-id="non-linear-regression">Non-linear Regression</h3>
<section id="case-1-model-function-is-known-explicitly" class="level4">
<h4 class="anchored" data-anchor-id="case-1-model-function-is-known-explicitly">Case 1: Model Function is Known Explicitly</h4>
<p>The method of least-squares can also be applied to fitting data to a non-linear model, such as the exponential growth model. <a href="#fig-BacterialGrowth" class="quarto-xref">Figure&nbsp;<span>6</span></a> shows the growth of bacteria.</p>
<div id="fig-BacterialGrowth" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-BacterialGrowth-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../..\chapters/Ch10/Figures/bacterialGrowthFitData.png" class="img-fluid figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-BacterialGrowth-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Growth of bacteria during the exponential growth phase.
</figcaption>
</figure>
</div>
<p>It is clear that a linear model will not describe this data. Indeed we know that an exponential growth model should work well. <a href="#eq-Equation10_exponentialGrowthModel" class="quarto-xref">Equation&nbsp;<span>7</span></a> gives the equation defining this model.</p>
<p><span id="eq-Equation10_exponentialGrowthModel"><span class="math display">\[N\left(t\right) = N_0e^{rt} \tag{7}\]</span></span></p>
<p>The complication with applying the method of least-squares to a non-linear model is that we do not have explicit formulae for the model parameters, <em>N<sub>0</sub></em> and <em>r</em>, as we did in the linear case. The computational problem is to perform a search through the parameter space to find the values that will minimize the Least Square Estimator good starting place. We will make use of a Python library function that will search for the model parameter values that minimize the Least Squares Estimator function given an initial starting guess for the values. The function is from the scipy.optimize library. It is the scipy.optimize.curve_fit()function <span class="citation" data-cites="TheSciPyCommunity_Scipyoptimizecurve_fitSciPyV193_2022">(<a href="../../bibliography.html#ref-TheSciPyCommunity_Scipyoptimizecurve_fitSciPyV193_2022" role="doc-biblioref">The SciPy Community, 2022a</a>)</span>. Here is the basic syntax for using the curve_fit function.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>popt, pcov <span class="op">=</span> scipy.optimize.curve_fit( f , tData , fData , p )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><em>f</em> is the callable function that calculates the theoretical value for the independent variable t. It must be in the form</p>
<p><span class="math inline">\(f(t, parameters)\)</span></p>
<p>where <em>t</em>, the independent variable must be listed first, and parameters must be listed separately, not in a tuple variable.</p>
<p>tData and fData are lists containing independent and dependent variable values for data points.</p>
<p>popt will be the list of optimized parameter values.</p>
<p>pcov contains the covariance matrix. It gives information about the uncertainty in the parameter estimates. Explicit values for statistical uncertainty are obtained using</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>psterr <span class="op">=</span> np.sqrt(np.diag(pcov))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>psterr is a list containing the standard error of each parameter estimate in the same order as in popt.</p>
<p><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction" class="quarto-xref">Figure&nbsp;<span>7</span></a> shows a program that can fit the exponential growth model of <a href="#eq-Equation10_exponentialGrowthModel" class="quarto-xref">Equation&nbsp;<span>7</span></a> to the data of <a href="#fig-BacterialGrowth" class="quarto-xref">Figure&nbsp;<span>6</span></a>.</p>
<div id="fig-NonLinearRegressionCodeWithKnownModelFunction" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-NonLinearRegressionCodeWithKnownModelFunction-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode" id="fig-NonLinearRegressionCodeWithKnownModelFunction"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="fig-NonLinearRegressionCodeWithKnownModelFunction-1"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-1" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-2"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-2" aria-hidden="true" tabindex="-1"></a><span class="co">Program: Non-linear Least Squares - Explicit Function Form</span></span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-3"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-3" aria-hidden="true" tabindex="-1"></a><span class="co">Author: C.D. Wentworth</span></span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-4"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-4" aria-hidden="true" tabindex="-1"></a><span class="co">Version: 10.25.2022.1</span></span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-5"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-5" aria-hidden="true" tabindex="-1"></a><span class="co">Summary: This program reads in bacterial growth data and fits</span></span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-6"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-6" aria-hidden="true" tabindex="-1"></a><span class="co">the data to the non-linear exponential growth model using the  </span></span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-7"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-7" aria-hidden="true" tabindex="-1"></a><span class="co">scipy.optimize.curve_fit() function. </span></span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-8"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-8" aria-hidden="true" tabindex="-1"></a><span class="co">Version History:</span></span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-9"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-9" aria-hidden="true" tabindex="-1"></a><span class="co">  3.28.2017.1: base version</span></span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-10"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-10" aria-hidden="true" tabindex="-1"></a><span class="co">  10.25.2022.1: added parameter uncertainty calculation</span></span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-11"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-12"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-12" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-13"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-14"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-15"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pylab <span class="im">as</span> plt</span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-16"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.optimize <span class="im">as</span> so</span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-17"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-18"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> N(t,N0,r):</span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-19"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-19" aria-hidden="true" tabindex="-1"></a>    tmp <span class="op">=</span> N0<span class="op">*</span>np.exp(r<span class="op">*</span>t)</span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-20"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tmp</span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-21"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-22"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-22" aria-hidden="true" tabindex="-1"></a><span class="co"># import data</span></span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-23"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-23" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> np.loadtxt(<span class="st">'BacterialGrowthData.txt'</span>, skiprows<span class="op">=</span><span class="dv">9</span>)</span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-24"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-24" aria-hidden="true" tabindex="-1"></a>tData <span class="op">=</span> cols[:, <span class="dv">0</span>]</span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-25"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-25" aria-hidden="true" tabindex="-1"></a>ODData <span class="op">=</span> cols[:, <span class="dv">1</span>]</span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-26"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-27"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Define initial guess for model parameters</span></span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-28"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-28" aria-hidden="true" tabindex="-1"></a>N0 <span class="op">=</span> <span class="fl">0.021</span></span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-29"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-29" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> <span class="fl">0.020</span></span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-30"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-30" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> N0,r</span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-31"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-32"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit data to exponential growth model</span></span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-33"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-33" aria-hidden="true" tabindex="-1"></a>popt,pcov <span class="op">=</span> so.curve_fit(N, tData, ODData, p)</span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-34"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-34" aria-hidden="true" tabindex="-1"></a>p_stderr <span class="op">=</span> np.sqrt(np.diag(pcov))</span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-35"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-36"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data</span></span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-37"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-37" aria-hidden="true" tabindex="-1"></a>plt.plot(tData, ODData, linestyle<span class="op">=</span><span class="st">''</span>, marker<span class="op">=</span><span class="st">'d'</span>,</span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-38"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-38" aria-hidden="true" tabindex="-1"></a>         markersize<span class="op">=</span><span class="fl">10.0</span>, label<span class="op">=</span><span class="st">'Data'</span>)</span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-39"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-40"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the theory</span></span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-41"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-41" aria-hidden="true" tabindex="-1"></a>N0,r <span class="op">=</span> popt</span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-42"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-42" aria-hidden="true" tabindex="-1"></a>dN0 <span class="op">=</span> p_stderr[<span class="dv">0</span>]</span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-43"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-43" aria-hidden="true" tabindex="-1"></a>dr <span class="op">=</span> p_stderr[<span class="dv">1</span>]</span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-44"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-44" aria-hidden="true" tabindex="-1"></a>tTheory <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">300</span>, <span class="dv">50</span>) </span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-45"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-45" aria-hidden="true" tabindex="-1"></a>ODTheory <span class="op">=</span> N(tTheory,N0,r)</span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-46"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-46" aria-hidden="true" tabindex="-1"></a>plt.plot(tTheory, ODTheory, label<span class="op">=</span><span class="st">'Theory'</span>)</span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-47"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-47" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'t [min]'</span>)</span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-48"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-48" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'OD [rel]'</span>)</span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-49"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-49" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-50"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-50" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'bacterialGrowthFitData.png'</span>)</span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-51"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-52"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-52" aria-hidden="true" tabindex="-1"></a><span class="co"># print out best-fit model parameters</span></span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-53"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-53" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'N0 = '</span>, <span class="bu">format</span>(N0,<span class="st">'6.4f'</span>), <span class="st">'+-'</span>, <span class="bu">format</span>(dN0,<span class="st">'7.4f'</span>))</span>
<span id="fig-NonLinearRegressionCodeWithKnownModelFunction-54"><a href="#fig-NonLinearRegressionCodeWithKnownModelFunction-54" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'r = '</span>, <span class="bu">format</span>(r,<span class="st">'6.4f'</span>), <span class="st">'+-'</span>, <span class="bu">format</span>(dr,<span class="st">'6.4f'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-NonLinearRegressionCodeWithKnownModelFunction-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: :Python program for using the curve_fit function.
</figcaption>
</figure>
</div>
<p><a href="#fig-BacterialGrowth" class="quarto-xref">Figure&nbsp;<span>6</span></a> shows the model fit to the data. The program will produce the following printed output giving least squares fit model parameter values and uncertainties.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>N0 <span class="op">=</span> <span class="fl">0.0112</span> <span class="op">+-</span> <span class="fl">0.0007</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> <span class="fl">0.0133</span> <span class="op">+-</span> <span class="fl">0.0002</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="case-2-model-function-value-must-be-obtained-by-numerical-integration" class="level4">
<h4 class="anchored" data-anchor-id="case-2-model-function-value-must-be-obtained-by-numerical-integration">Case 2: Model Function value must be obtained by numerical integration</h4>
<p>We have worked with mathematical models where the actual model function describing how the dependent variable depends on the independent variable is not known, but instead the model is defined by an ordinary differential equation or system of such equations. We learned how to numerically integrate the differential equation to obtain model values for selected independent variable values.</p>
<p>How can we use the least squares technique for finding best-fit model parameters for this case where we must integrate a differential equation to get model values? We can still use the curve_fit function to perform the least squares minimization search, but we must do some extra work to give it the required callable model function. The function will be defined to have the form</p>
<p>f(t, parameters)</p>
<p>but inside this function definition we use the numerical integration function scipy.integrate.solve_ivp and integrate the differential equation from the initial independent variable value up to the desired independent variable value. The function will return just this last calculated dependent variable value, as required by the curve_fit function.</p>
<p>We will continue to work with the exponential growth model as a test case for working through the details of this method. The rate equation for the population function <span class="math inline">\(y\left(t\right)\)</span> is</p>
<p><span id="eq-Equation10_ExpGrowthModel"><span class="math display">\[\frac{dy}{dt} = ry\left(t\right) \tag{8}\]</span></span></p>
<p>and there is a known initial condition of the form</p>
<p><span class="math display">\[y\left(0\right) = y_i\]</span></p>
<p>Letâ€™s start with the basic setup required to use solv_ivp to integrate the exponential growth rate equation that we discussed back in Chapter 7. We must define a Python function <em>f</em> that calculates the rate of change of the state variable <em>y</em> for an array of independent variable values <em>t</em>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.integrate <span class="im">as</span> si</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pylab <span class="im">as</span> plt</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.optimize <span class="im">as</span> so</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a function that defines the rhs of the differential equation system</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> f(t,y,r):</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   y = a list that contains the system state</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   t = the time for which the right-hand-side of the system equations</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co">#       is to be calculated.  </span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   r = a parameter needed for the model</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   Unpack the state of the system</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    y0 <span class="op">=</span> y[<span class="dv">0</span>] <span class="co"># value of the state variable y at t</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co">#   Calculate the rates of change (the derivatives)</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    dy0dt <span class="op">=</span> r<span class="op">*</span>y0</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [dy0dt]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Next, we will define the callable model function required by curve_fit that will use the numerical integration method to calculate the value of the state variable y. We will name this function yf.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> yf(t,yi,r):</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> r,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    yv <span class="op">=</span> []</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    y_0 <span class="op">=</span> [yi]</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> tt <span class="kw">in</span> t:</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> np.<span class="bu">abs</span>(tt)<span class="op">&lt;</span><span class="fl">1.e-5</span>:</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>            yvt <span class="op">=</span> yi</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>            ta <span class="op">=</span> np.linspace(<span class="dv">0</span>,tt,<span class="dv">10</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Solve the DE</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>            sol <span class="op">=</span> si.solve_ivp(f,(<span class="dv">0</span>,tt),y_0,t_eval<span class="op">=</span>ta,args<span class="op">=</span>p)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>            yvt <span class="op">=</span> sol.y[<span class="dv">0</span>][<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>        yv.append(yvt)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> yv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The callable function yf for the curve_fit function is designed to accept an array of independent variable values in the t array, which will normally be a numpy array. This requires the for loop to calculate the model function value by numerical integration for each value in t. The Python code that implements this idea is shown in <a href="#fig-Figure10_NonLinRegWithNumIntCode" class="quarto-xref">Figure&nbsp;<span>8</span></a> and is contained in the file expGrowthModelNonLinRegNumSol.py.</p>
<div id="fig-Figure10_NonLinRegWithNumIntCode" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-Figure10_NonLinRegWithNumIntCode-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode" id="fig-Figure10_NonLinRegWithNumIntCode"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="fig-Figure10_NonLinRegWithNumIntCode-1"><a href="#fig-Figure10_NonLinRegWithNumIntCode-1" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-2"><a href="#fig-Figure10_NonLinRegWithNumIntCode-2" aria-hidden="true" tabindex="-1"></a><span class="co">Program Name: Non-linear Least Squares - </span></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-3"><a href="#fig-Figure10_NonLinRegWithNumIntCode-3" aria-hidden="true" tabindex="-1"></a><span class="co">              Numerical Integration Form</span></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-4"><a href="#fig-Figure10_NonLinRegWithNumIntCode-4" aria-hidden="true" tabindex="-1"></a><span class="co">Author: C.D. Wentworth</span></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-5"><a href="#fig-Figure10_NonLinRegWithNumIntCode-5" aria-hidden="true" tabindex="-1"></a><span class="co">version: 10.27.2022.1</span></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-6"><a href="#fig-Figure10_NonLinRegWithNumIntCode-6" aria-hidden="true" tabindex="-1"></a><span class="co">Summary: This program reads in bacterial growth data and fits</span></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-7"><a href="#fig-Figure10_NonLinRegWithNumIntCode-7" aria-hidden="true" tabindex="-1"></a><span class="co">         the data to the non-linear exponential growth model </span></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-8"><a href="#fig-Figure10_NonLinRegWithNumIntCode-8" aria-hidden="true" tabindex="-1"></a><span class="co">         using the scipy.optimize.curve_fit() function. This</span></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-9"><a href="#fig-Figure10_NonLinRegWithNumIntCode-9" aria-hidden="true" tabindex="-1"></a><span class="co">         version uses a numerical integration method for </span></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-10"><a href="#fig-Figure10_NonLinRegWithNumIntCode-10" aria-hidden="true" tabindex="-1"></a><span class="co">         calculating values of the model function.</span></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-11"><a href="#fig-Figure10_NonLinRegWithNumIntCode-11" aria-hidden="true" tabindex="-1"></a><span class="co">History:</span></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-12"><a href="#fig-Figure10_NonLinRegWithNumIntCode-12" aria-hidden="true" tabindex="-1"></a><span class="co">         3.17.2020.1: base</span></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-13"><a href="#fig-Figure10_NonLinRegWithNumIntCode-13" aria-hidden="true" tabindex="-1"></a><span class="co">         10.27.2022.1: changed variable names</span></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-14"><a href="#fig-Figure10_NonLinRegWithNumIntCode-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-15"><a href="#fig-Figure10_NonLinRegWithNumIntCode-15" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-16"><a href="#fig-Figure10_NonLinRegWithNumIntCode-16" aria-hidden="true" tabindex="-1"></a> </span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-17"><a href="#fig-Figure10_NonLinRegWithNumIntCode-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.integrate <span class="im">as</span> si</span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-18"><a href="#fig-Figure10_NonLinRegWithNumIntCode-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-19"><a href="#fig-Figure10_NonLinRegWithNumIntCode-19" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pylab <span class="im">as</span> plt</span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-20"><a href="#fig-Figure10_NonLinRegWithNumIntCode-20" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.optimize <span class="im">as</span> so</span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-21"><a href="#fig-Figure10_NonLinRegWithNumIntCode-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-22"><a href="#fig-Figure10_NonLinRegWithNumIntCode-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a function that defines the rhs of the differential equation system</span></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-23"><a href="#fig-Figure10_NonLinRegWithNumIntCode-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-24"><a href="#fig-Figure10_NonLinRegWithNumIntCode-24" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> f(t,y,r):</span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-25"><a href="#fig-Figure10_NonLinRegWithNumIntCode-25" aria-hidden="true" tabindex="-1"></a><span class="co">#   y = a list that contains the system state</span></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-26"><a href="#fig-Figure10_NonLinRegWithNumIntCode-26" aria-hidden="true" tabindex="-1"></a><span class="co">#   t = the time for which the right-hand-side of the system equations</span></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-27"><a href="#fig-Figure10_NonLinRegWithNumIntCode-27" aria-hidden="true" tabindex="-1"></a><span class="co">#       is to be calculated.</span></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-28"><a href="#fig-Figure10_NonLinRegWithNumIntCode-28" aria-hidden="true" tabindex="-1"></a><span class="co">#   r = a parameter needed for the model</span></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-29"><a href="#fig-Figure10_NonLinRegWithNumIntCode-29" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-30"><a href="#fig-Figure10_NonLinRegWithNumIntCode-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-31"><a href="#fig-Figure10_NonLinRegWithNumIntCode-31" aria-hidden="true" tabindex="-1"></a><span class="co">#   Unpack the state of the system</span></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-32"><a href="#fig-Figure10_NonLinRegWithNumIntCode-32" aria-hidden="true" tabindex="-1"></a>    y0 <span class="op">=</span> y[<span class="dv">0</span>] <span class="co"># value of the state variable at t</span></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-33"><a href="#fig-Figure10_NonLinRegWithNumIntCode-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-34"><a href="#fig-Figure10_NonLinRegWithNumIntCode-34" aria-hidden="true" tabindex="-1"></a><span class="co">#   Calculate the rates of change (the derivatives)</span></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-35"><a href="#fig-Figure10_NonLinRegWithNumIntCode-35" aria-hidden="true" tabindex="-1"></a>    dy0dt <span class="op">=</span> r<span class="op">*</span>y0</span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-36"><a href="#fig-Figure10_NonLinRegWithNumIntCode-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-37"><a href="#fig-Figure10_NonLinRegWithNumIntCode-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [dy0dt]</span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-38"><a href="#fig-Figure10_NonLinRegWithNumIntCode-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-39"><a href="#fig-Figure10_NonLinRegWithNumIntCode-39" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> yf(t,yi,r):</span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-40"><a href="#fig-Figure10_NonLinRegWithNumIntCode-40" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> r,</span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-41"><a href="#fig-Figure10_NonLinRegWithNumIntCode-41" aria-hidden="true" tabindex="-1"></a>    yv <span class="op">=</span> []</span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-42"><a href="#fig-Figure10_NonLinRegWithNumIntCode-42" aria-hidden="true" tabindex="-1"></a>    y_0 <span class="op">=</span> [yi]</span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-43"><a href="#fig-Figure10_NonLinRegWithNumIntCode-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> tt <span class="kw">in</span> t:</span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-44"><a href="#fig-Figure10_NonLinRegWithNumIntCode-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> np.<span class="bu">abs</span>(tt)<span class="op">&lt;</span><span class="fl">1.e-5</span>:</span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-45"><a href="#fig-Figure10_NonLinRegWithNumIntCode-45" aria-hidden="true" tabindex="-1"></a>            yvt <span class="op">=</span> yi</span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-46"><a href="#fig-Figure10_NonLinRegWithNumIntCode-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-47"><a href="#fig-Figure10_NonLinRegWithNumIntCode-47" aria-hidden="true" tabindex="-1"></a>            ta <span class="op">=</span> np.linspace(<span class="dv">0</span>,tt,<span class="dv">10</span>)</span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-48"><a href="#fig-Figure10_NonLinRegWithNumIntCode-48" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Solve the DE</span></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-49"><a href="#fig-Figure10_NonLinRegWithNumIntCode-49" aria-hidden="true" tabindex="-1"></a>            sol <span class="op">=</span> si.solve_ivp(f,(<span class="dv">0</span>,tt),y_0,t_eval<span class="op">=</span>ta,args<span class="op">=</span>p)</span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-50"><a href="#fig-Figure10_NonLinRegWithNumIntCode-50" aria-hidden="true" tabindex="-1"></a>            yvt <span class="op">=</span> sol.y[<span class="dv">0</span>][<span class="op">-</span><span class="dv">1</span>]</span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-51"><a href="#fig-Figure10_NonLinRegWithNumIntCode-51" aria-hidden="true" tabindex="-1"></a>        yv.append(yvt)</span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-52"><a href="#fig-Figure10_NonLinRegWithNumIntCode-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> yv</span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-53"><a href="#fig-Figure10_NonLinRegWithNumIntCode-53" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-54"><a href="#fig-Figure10_NonLinRegWithNumIntCode-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Main Program</span></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-55"><a href="#fig-Figure10_NonLinRegWithNumIntCode-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-56"><a href="#fig-Figure10_NonLinRegWithNumIntCode-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in data</span></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-57"><a href="#fig-Figure10_NonLinRegWithNumIntCode-57" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> np.loadtxt(<span class="st">'BacterialGrowthData.txt'</span>,skiprows<span class="op">=</span><span class="dv">9</span>)</span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-58"><a href="#fig-Figure10_NonLinRegWithNumIntCode-58" aria-hidden="true" tabindex="-1"></a>td <span class="op">=</span> cols[:,<span class="dv">0</span>]</span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-59"><a href="#fig-Figure10_NonLinRegWithNumIntCode-59" aria-hidden="true" tabindex="-1"></a>OD <span class="op">=</span> cols[:,<span class="dv">1</span>]</span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-60"><a href="#fig-Figure10_NonLinRegWithNumIntCode-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-61"><a href="#fig-Figure10_NonLinRegWithNumIntCode-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Define initial guess for model parameters</span></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-62"><a href="#fig-Figure10_NonLinRegWithNumIntCode-62" aria-hidden="true" tabindex="-1"></a>yi <span class="op">=</span> <span class="fl">0.022</span></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-63"><a href="#fig-Figure10_NonLinRegWithNumIntCode-63" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> <span class="fl">0.02</span></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-64"><a href="#fig-Figure10_NonLinRegWithNumIntCode-64" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> (yi,r)</span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-65"><a href="#fig-Figure10_NonLinRegWithNumIntCode-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-66"><a href="#fig-Figure10_NonLinRegWithNumIntCode-66" aria-hidden="true" tabindex="-1"></a>popt,pcov <span class="op">=</span> so.curve_fit(yf,td,OD,p)</span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-67"><a href="#fig-Figure10_NonLinRegWithNumIntCode-67" aria-hidden="true" tabindex="-1"></a>p_stderr <span class="op">=</span> np.sqrt(np.diag(pcov))</span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-68"><a href="#fig-Figure10_NonLinRegWithNumIntCode-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-69"><a href="#fig-Figure10_NonLinRegWithNumIntCode-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate theoretical values</span></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-70"><a href="#fig-Figure10_NonLinRegWithNumIntCode-70" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the time grid</span></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-71"><a href="#fig-Figure10_NonLinRegWithNumIntCode-71" aria-hidden="true" tabindex="-1"></a>ta <span class="op">=</span> np.linspace(<span class="dv">0</span>,<span class="dv">300</span>,<span class="dv">200</span>)</span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-72"><a href="#fig-Figure10_NonLinRegWithNumIntCode-72" aria-hidden="true" tabindex="-1"></a>yi,r <span class="op">=</span> popt</span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-73"><a href="#fig-Figure10_NonLinRegWithNumIntCode-73" aria-hidden="true" tabindex="-1"></a>dyi <span class="op">=</span> p_stderr[<span class="dv">0</span>]</span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-74"><a href="#fig-Figure10_NonLinRegWithNumIntCode-74" aria-hidden="true" tabindex="-1"></a>dr <span class="op">=</span> p_stderr[<span class="dv">1</span>]</span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-75"><a href="#fig-Figure10_NonLinRegWithNumIntCode-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-76"><a href="#fig-Figure10_NonLinRegWithNumIntCode-76" aria-hidden="true" tabindex="-1"></a>yTheory <span class="op">=</span> yf(ta,yi,r)</span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-77"><a href="#fig-Figure10_NonLinRegWithNumIntCode-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-78"><a href="#fig-Figure10_NonLinRegWithNumIntCode-78" aria-hidden="true" tabindex="-1"></a><span class="co"># print out best-fit model parameters</span></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-79"><a href="#fig-Figure10_NonLinRegWithNumIntCode-79" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'yi = '</span>, <span class="bu">format</span>(yi,<span class="st">'6.4f'</span>), <span class="st">'+-'</span>, <span class="bu">format</span>(dyi,<span class="st">'7.4f'</span>))</span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-80"><a href="#fig-Figure10_NonLinRegWithNumIntCode-80" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'r = '</span>, <span class="bu">format</span>(r,<span class="st">'6.4f'</span>), <span class="st">'+-'</span>, <span class="bu">format</span>(dr,<span class="st">'6.4f'</span>))</span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-81"><a href="#fig-Figure10_NonLinRegWithNumIntCode-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-82"><a href="#fig-Figure10_NonLinRegWithNumIntCode-82" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the solution</span></span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-83"><a href="#fig-Figure10_NonLinRegWithNumIntCode-83" aria-hidden="true" tabindex="-1"></a>plt.plot(td,OD,linestyle<span class="op">=</span><span class="st">''</span>,marker<span class="op">=</span><span class="st">'o'</span>,markersize<span class="op">=</span><span class="fl">10.0</span>, </span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-84"><a href="#fig-Figure10_NonLinRegWithNumIntCode-84" aria-hidden="true" tabindex="-1"></a>         label<span class="op">=</span><span class="st">'Data'</span>)</span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-85"><a href="#fig-Figure10_NonLinRegWithNumIntCode-85" aria-hidden="true" tabindex="-1"></a>plt.plot(ta,yTheory,color<span class="op">=</span><span class="st">'g'</span>, label<span class="op">=</span><span class="st">'Theory'</span>)</span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-86"><a href="#fig-Figure10_NonLinRegWithNumIntCode-86" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-87"><a href="#fig-Figure10_NonLinRegWithNumIntCode-87" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'t [min]'</span>)</span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-88"><a href="#fig-Figure10_NonLinRegWithNumIntCode-88" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'OD [rel]'</span>)</span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-89"><a href="#fig-Figure10_NonLinRegWithNumIntCode-89" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'bacterialGrowthFitDataNumInt.png'</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="fig-Figure10_NonLinRegWithNumIntCode-90"><a href="#fig-Figure10_NonLinRegWithNumIntCode-90" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Figure10_NonLinRegWithNumIntCode-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: :Python code for performing nonlinear least squares data fitting using numerical integration.
</figcaption>
</figure>
</div>
<p>The graph and print out of the best-fit model parameters are exactly the same as were produced by the code in <a href="#fig-NonLinearRegressionCodeWithKnownModelFunction" class="quarto-xref">Figure&nbsp;<span>7</span></a>, which provides evidence that the more complicated numerical integration method for calculating the model function values works for the curve_fit function.</p>
</section>
</section>
</section>
<section id="computational-problem-solving-damped-spring-best-fit-model-parameter-values:sec" class="level2">
<h2 class="anchored" data-anchor-id="computational-problem-solving-damped-spring-best-fit-model-parameter-values:sec">Computational Problem Solving: Damped Spring â€“ Best-fit Model Parameter Values</h2>
<p>We return now to the problem of the damped spring, described at the beginning of the chapter. The experimental setup is shown in Figure 10.1 and the data is contained in the file dampedSpringData.txt.</p>
<p>Problem Statement: Given the position-time data shown in Figure 10.2, find the best-fit model parameters by fitting the data to the damped spring position-time model function given by Equation (10.1) reproduced here.</p>
<p><span id="eq-Equation10_dampedSpringModelRepeat"><span class="math display">\[\begin{array}{l} y\left(t\right) = Ae^{- bt/ 2m}\cos \left(\omega t + \phi_0\right) \\ \\ \omega  = \sqrt{\omega_0^2- \frac{b^2}{4m^2}}\text{ , }\omega_0 = \sqrt{\frac{k}{m}} \\  \end{array} \tag{9}\]</span></span></p>
<section id="analysis-analyze-the-problem" class="level3">
<h3 class="anchored" data-anchor-id="analysis-analyze-the-problem">Analysis: Analyze the problem</h3>
<p>We will not reproduce the physics analysis of the situation here, since it is covered in standard university physics textbooks (Knight, 2016). The mass of the object is assumed to be fixed at the measured value of <em>m</em> = 0.550 [kg]. A static force constant value of <em>k=22.9</em> [N/m] is also provided with the data. This value of <em>k</em> will not necessarily be the best-fit value for the damped oscillator. The model parameters that must be determined are <span class="math inline">\((A,b,k)\)</span>. We will use the least squares technique to find the optimum values of these parameters. We will need to use the nonlinear version of this method available to us through the curve_fit function.</p>
</section>
<section id="design-describe-the-data-and-develop-algorithms" class="level3">
<h3 class="anchored" data-anchor-id="design-describe-the-data-and-develop-algorithms">Design: Describe the data and develop algorithms</h3>
<p>The position data shows an oscillation about a nonzero equilibrium point, but the model function we are using assumes an oscillation about <em>y=0</em>. We can adjust the position data by a constant amount to achieve this. Use the basic data plotting template and add the following line to adjust the position.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in data</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> np.loadtxt(<span class="st">'dampedSpringData.txt'</span>,skiprows<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>tData <span class="op">=</span> cols[:,<span class="dv">0</span>]</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>yData <span class="op">=</span> cols[:,<span class="dv">1</span>]</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust the y values by a constant amount</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>yData <span class="op">=</span> yData <span class="op">-</span> <span class="fl">0.7</span>    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>An adjustment value of 0.7 appears to work well, as shown in <a href="#fig-AdjustedSpringPositionData" class="quarto-xref">Figure&nbsp;<span>9</span></a>. The adjustment is applied to all values in the array yData since it is a numpy array.</p>
<div id="fig-AdjustedSpringPositionData" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-AdjustedSpringPositionData-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../..\chapters/Ch10/Figures/dampedSpringDataAdjusted.png" class="img-fluid figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-AdjustedSpringPositionData-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9: Adjusted spring position data.
</figcaption>
</figure>
</div>
<p>Starting guesses for the model parameters must be provided to the curve_fit function. Here are some possible values to use.</p>
<p><span class="math display">\[\begin{array}{l} \begin{array}{l} A = 0.22\left[\text{m}\right] \\ b = 1.0 \\ k = 22.9\left[\text{N/m}\right] \\  \end{array} \\ \phi_0 = \pi \left[\text{radians}\right] \\  \end{array}\]</span></p>
<p>We can reuse the algorithm design used for the code in <a href="#fig-NonLinearRegressionCodeWithKnownModelFunction" class="quarto-xref">Figure&nbsp;<span>7</span></a>. We just need to replace the model function <em>N</em> used in that code with the model function from <a href="#eq-Equation10_dampedSpringModelRepeat" class="quarto-xref">Equation&nbsp;<span>9</span></a> .</p>
</section>
<section id="implementation" class="level3">
<h3 class="anchored" data-anchor-id="implementation">Implementation</h3>
<p>The design described above implemented in Python code is shown in <a href="#fig-Figure10_CodeForDampedSpringModel" class="quarto-xref">Figure&nbsp;<span>10</span></a>. The code is in the file dampedSpringModelNonlinearRegression.py.</p>
<div id="fig-Figure10_CodeForDampedSpringModel" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-Figure10_CodeForDampedSpringModel-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode" id="fig-Figure10_CodeForDampedSpringModel"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="fig-Figure10_CodeForDampedSpringModel-1"><a href="#fig-Figure10_CodeForDampedSpringModel-1" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="fig-Figure10_CodeForDampedSpringModel-2"><a href="#fig-Figure10_CodeForDampedSpringModel-2" aria-hidden="true" tabindex="-1"></a><span class="co">Program: Damped Spring Model Data Fitting</span></span>
<span id="fig-Figure10_CodeForDampedSpringModel-3"><a href="#fig-Figure10_CodeForDampedSpringModel-3" aria-hidden="true" tabindex="-1"></a><span class="co">Author: C.D. Wentworth</span></span>
<span id="fig-Figure10_CodeForDampedSpringModel-4"><a href="#fig-Figure10_CodeForDampedSpringModel-4" aria-hidden="true" tabindex="-1"></a><span class="co">Version: 10.25.2022.1</span></span>
<span id="fig-Figure10_CodeForDampedSpringModel-5"><a href="#fig-Figure10_CodeForDampedSpringModel-5" aria-hidden="true" tabindex="-1"></a><span class="co">Summary: This program reads in position-time data for</span></span>
<span id="fig-Figure10_CodeForDampedSpringModel-6"><a href="#fig-Figure10_CodeForDampedSpringModel-6" aria-hidden="true" tabindex="-1"></a><span class="co">an object attached to a damped spring and fits</span></span>
<span id="fig-Figure10_CodeForDampedSpringModel-7"><a href="#fig-Figure10_CodeForDampedSpringModel-7" aria-hidden="true" tabindex="-1"></a><span class="co">the data to the standard damped spring model function</span></span>
<span id="fig-Figure10_CodeForDampedSpringModel-8"><a href="#fig-Figure10_CodeForDampedSpringModel-8" aria-hidden="true" tabindex="-1"></a><span class="co">using the scipy.optimize.curve_fit() function. </span></span>
<span id="fig-Figure10_CodeForDampedSpringModel-9"><a href="#fig-Figure10_CodeForDampedSpringModel-9" aria-hidden="true" tabindex="-1"></a><span class="co">Version History:</span></span>
<span id="fig-Figure10_CodeForDampedSpringModel-10"><a href="#fig-Figure10_CodeForDampedSpringModel-10" aria-hidden="true" tabindex="-1"></a><span class="co">  10.25.2022.1: base</span></span>
<span id="fig-Figure10_CodeForDampedSpringModel-11"><a href="#fig-Figure10_CodeForDampedSpringModel-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="fig-Figure10_CodeForDampedSpringModel-12"><a href="#fig-Figure10_CodeForDampedSpringModel-12" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="fig-Figure10_CodeForDampedSpringModel-13"><a href="#fig-Figure10_CodeForDampedSpringModel-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="fig-Figure10_CodeForDampedSpringModel-14"><a href="#fig-Figure10_CodeForDampedSpringModel-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="fig-Figure10_CodeForDampedSpringModel-15"><a href="#fig-Figure10_CodeForDampedSpringModel-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pylab <span class="im">as</span> plt</span>
<span id="fig-Figure10_CodeForDampedSpringModel-16"><a href="#fig-Figure10_CodeForDampedSpringModel-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.optimize <span class="im">as</span> so</span>
<span id="fig-Figure10_CodeForDampedSpringModel-17"><a href="#fig-Figure10_CodeForDampedSpringModel-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="fig-Figure10_CodeForDampedSpringModel-18"><a href="#fig-Figure10_CodeForDampedSpringModel-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> yf(t, A, b, k, phi0):</span>
<span id="fig-Figure10_CodeForDampedSpringModel-19"><a href="#fig-Figure10_CodeForDampedSpringModel-19" aria-hidden="true" tabindex="-1"></a>    m <span class="op">=</span> <span class="fl">0.550</span>  <span class="co"># [kg]</span></span>
<span id="fig-Figure10_CodeForDampedSpringModel-20"><a href="#fig-Figure10_CodeForDampedSpringModel-20" aria-hidden="true" tabindex="-1"></a>    w0 <span class="op">=</span> np.sqrt(k<span class="op">/</span>m)</span>
<span id="fig-Figure10_CodeForDampedSpringModel-21"><a href="#fig-Figure10_CodeForDampedSpringModel-21" aria-hidden="true" tabindex="-1"></a>    w <span class="op">=</span> np.sqrt(w0<span class="op">**</span><span class="dv">2</span> <span class="op">-</span> b<span class="op">**</span><span class="dv">2</span><span class="op">/</span>(<span class="fl">4.0</span><span class="op">*</span>m<span class="op">**</span><span class="dv">2</span>))</span>
<span id="fig-Figure10_CodeForDampedSpringModel-22"><a href="#fig-Figure10_CodeForDampedSpringModel-22" aria-hidden="true" tabindex="-1"></a>    tmp <span class="op">=</span> A<span class="op">*</span>np.exp(<span class="op">-</span>b<span class="op">*</span>t<span class="op">/</span>(<span class="fl">2.0</span><span class="op">*</span>m))<span class="op">*</span>np.cos(w<span class="op">*</span>t <span class="op">+</span> phi0)</span>
<span id="fig-Figure10_CodeForDampedSpringModel-23"><a href="#fig-Figure10_CodeForDampedSpringModel-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tmp</span>
<span id="fig-Figure10_CodeForDampedSpringModel-24"><a href="#fig-Figure10_CodeForDampedSpringModel-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="fig-Figure10_CodeForDampedSpringModel-25"><a href="#fig-Figure10_CodeForDampedSpringModel-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in data</span></span>
<span id="fig-Figure10_CodeForDampedSpringModel-26"><a href="#fig-Figure10_CodeForDampedSpringModel-26" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> np.loadtxt(<span class="st">'dampedSpringData.txt'</span>,skiprows<span class="op">=</span><span class="dv">3</span>)</span>
<span id="fig-Figure10_CodeForDampedSpringModel-27"><a href="#fig-Figure10_CodeForDampedSpringModel-27" aria-hidden="true" tabindex="-1"></a>tData <span class="op">=</span> cols[:,<span class="dv">0</span>]</span>
<span id="fig-Figure10_CodeForDampedSpringModel-28"><a href="#fig-Figure10_CodeForDampedSpringModel-28" aria-hidden="true" tabindex="-1"></a>yData <span class="op">=</span> cols[:,<span class="dv">1</span>]</span>
<span id="fig-Figure10_CodeForDampedSpringModel-29"><a href="#fig-Figure10_CodeForDampedSpringModel-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="fig-Figure10_CodeForDampedSpringModel-30"><a href="#fig-Figure10_CodeForDampedSpringModel-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust the y data values by a constant amount</span></span>
<span id="fig-Figure10_CodeForDampedSpringModel-31"><a href="#fig-Figure10_CodeForDampedSpringModel-31" aria-hidden="true" tabindex="-1"></a>yData <span class="op">=</span> yData <span class="op">-</span> <span class="fl">0.7</span></span>
<span id="fig-Figure10_CodeForDampedSpringModel-32"><a href="#fig-Figure10_CodeForDampedSpringModel-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="fig-Figure10_CodeForDampedSpringModel-33"><a href="#fig-Figure10_CodeForDampedSpringModel-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Define initial guess for model parameters</span></span>
<span id="fig-Figure10_CodeForDampedSpringModel-34"><a href="#fig-Figure10_CodeForDampedSpringModel-34" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> <span class="fl">0.22</span></span>
<span id="fig-Figure10_CodeForDampedSpringModel-35"><a href="#fig-Figure10_CodeForDampedSpringModel-35" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> <span class="fl">1.0</span></span>
<span id="fig-Figure10_CodeForDampedSpringModel-36"><a href="#fig-Figure10_CodeForDampedSpringModel-36" aria-hidden="true" tabindex="-1"></a>k <span class="op">=</span> <span class="fl">22.9</span></span>
<span id="fig-Figure10_CodeForDampedSpringModel-37"><a href="#fig-Figure10_CodeForDampedSpringModel-37" aria-hidden="true" tabindex="-1"></a>phi0 <span class="op">=</span> np.pi</span>
<span id="fig-Figure10_CodeForDampedSpringModel-38"><a href="#fig-Figure10_CodeForDampedSpringModel-38" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> A, b, k, phi0</span>
<span id="fig-Figure10_CodeForDampedSpringModel-39"><a href="#fig-Figure10_CodeForDampedSpringModel-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="fig-Figure10_CodeForDampedSpringModel-40"><a href="#fig-Figure10_CodeForDampedSpringModel-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit data to the damped spring model</span></span>
<span id="fig-Figure10_CodeForDampedSpringModel-41"><a href="#fig-Figure10_CodeForDampedSpringModel-41" aria-hidden="true" tabindex="-1"></a>popt,pcov <span class="op">=</span> so.curve_fit(yf, tData, yData, p)</span>
<span id="fig-Figure10_CodeForDampedSpringModel-42"><a href="#fig-Figure10_CodeForDampedSpringModel-42" aria-hidden="true" tabindex="-1"></a>p_stderr <span class="op">=</span> np.sqrt(np.diag(pcov))</span>
<span id="fig-Figure10_CodeForDampedSpringModel-43"><a href="#fig-Figure10_CodeForDampedSpringModel-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="fig-Figure10_CodeForDampedSpringModel-44"><a href="#fig-Figure10_CodeForDampedSpringModel-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data</span></span>
<span id="fig-Figure10_CodeForDampedSpringModel-45"><a href="#fig-Figure10_CodeForDampedSpringModel-45" aria-hidden="true" tabindex="-1"></a>plt.plot(tData, yData, linestyle<span class="op">=</span><span class="st">''</span>, marker<span class="op">=</span><span class="st">'d'</span>,</span>
<span id="fig-Figure10_CodeForDampedSpringModel-46"><a href="#fig-Figure10_CodeForDampedSpringModel-46" aria-hidden="true" tabindex="-1"></a>         markersize<span class="op">=</span><span class="fl">7.0</span>, label<span class="op">=</span><span class="st">'Data'</span>)</span>
<span id="fig-Figure10_CodeForDampedSpringModel-47"><a href="#fig-Figure10_CodeForDampedSpringModel-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="fig-Figure10_CodeForDampedSpringModel-48"><a href="#fig-Figure10_CodeForDampedSpringModel-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the theory</span></span>
<span id="fig-Figure10_CodeForDampedSpringModel-49"><a href="#fig-Figure10_CodeForDampedSpringModel-49" aria-hidden="true" tabindex="-1"></a>A, b, k, phi0 <span class="op">=</span> popt</span>
<span id="fig-Figure10_CodeForDampedSpringModel-50"><a href="#fig-Figure10_CodeForDampedSpringModel-50" aria-hidden="true" tabindex="-1"></a>dA <span class="op">=</span> p_stderr[<span class="dv">0</span>]</span>
<span id="fig-Figure10_CodeForDampedSpringModel-51"><a href="#fig-Figure10_CodeForDampedSpringModel-51" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> p_stderr[<span class="dv">1</span>]</span>
<span id="fig-Figure10_CodeForDampedSpringModel-52"><a href="#fig-Figure10_CodeForDampedSpringModel-52" aria-hidden="true" tabindex="-1"></a>dk <span class="op">=</span> p_stderr[<span class="dv">2</span>]</span>
<span id="fig-Figure10_CodeForDampedSpringModel-53"><a href="#fig-Figure10_CodeForDampedSpringModel-53" aria-hidden="true" tabindex="-1"></a>dphi0 <span class="op">=</span> p_stderr[<span class="dv">3</span>]</span>
<span id="fig-Figure10_CodeForDampedSpringModel-54"><a href="#fig-Figure10_CodeForDampedSpringModel-54" aria-hidden="true" tabindex="-1"></a>tTheory <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">500</span>) </span>
<span id="fig-Figure10_CodeForDampedSpringModel-55"><a href="#fig-Figure10_CodeForDampedSpringModel-55" aria-hidden="true" tabindex="-1"></a>yTheory <span class="op">=</span> yf(tTheory, A, b, k, phi0)</span>
<span id="fig-Figure10_CodeForDampedSpringModel-56"><a href="#fig-Figure10_CodeForDampedSpringModel-56" aria-hidden="true" tabindex="-1"></a>plt.plot(tTheory, yTheory, color<span class="op">=</span><span class="st">'red'</span>, linewidth<span class="op">=</span><span class="dv">3</span>, label<span class="op">=</span><span class="st">'Theory'</span>)</span>
<span id="fig-Figure10_CodeForDampedSpringModel-57"><a href="#fig-Figure10_CodeForDampedSpringModel-57" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'t [s]'</span>)</span>
<span id="fig-Figure10_CodeForDampedSpringModel-58"><a href="#fig-Figure10_CodeForDampedSpringModel-58" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'y [m]'</span>)</span>
<span id="fig-Figure10_CodeForDampedSpringModel-59"><a href="#fig-Figure10_CodeForDampedSpringModel-59" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="fig-Figure10_CodeForDampedSpringModel-60"><a href="#fig-Figure10_CodeForDampedSpringModel-60" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Least Squares Fit to Damped Spring Model'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="fig-Figure10_CodeForDampedSpringModel-61"><a href="#fig-Figure10_CodeForDampedSpringModel-61" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'dampedSpringFitData.png'</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="fig-Figure10_CodeForDampedSpringModel-62"><a href="#fig-Figure10_CodeForDampedSpringModel-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="fig-Figure10_CodeForDampedSpringModel-63"><a href="#fig-Figure10_CodeForDampedSpringModel-63" aria-hidden="true" tabindex="-1"></a><span class="co"># print out best-fit model parameters</span></span>
<span id="fig-Figure10_CodeForDampedSpringModel-64"><a href="#fig-Figure10_CodeForDampedSpringModel-64" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'A = '</span>, <span class="bu">format</span>(A,<span class="st">'6.4f'</span>), <span class="st">'+-'</span>, <span class="bu">format</span>(dA,<span class="st">'7.4f'</span>))</span>
<span id="fig-Figure10_CodeForDampedSpringModel-65"><a href="#fig-Figure10_CodeForDampedSpringModel-65" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'b = '</span>, <span class="bu">format</span>(b,<span class="st">'6.4f'</span>), <span class="st">'+-'</span>, <span class="bu">format</span>(db,<span class="st">'6.4f'</span>))</span>
<span id="fig-Figure10_CodeForDampedSpringModel-66"><a href="#fig-Figure10_CodeForDampedSpringModel-66" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'k = '</span>, <span class="bu">format</span>(k,<span class="st">'6.3f'</span>), <span class="st">'+-'</span>, <span class="bu">format</span>(dk,<span class="st">'6.3f'</span>))</span>
<span id="fig-Figure10_CodeForDampedSpringModel-67"><a href="#fig-Figure10_CodeForDampedSpringModel-67" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'phi0 = '</span>, <span class="bu">format</span>(phi0,<span class="st">'6.3f'</span>), <span class="st">'+-'</span>, <span class="bu">format</span>(dphi0,<span class="st">'6.3f'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Figure10_CodeForDampedSpringModel-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10: :Python code for performing the least squares fit of spring position data to the damped spring model.
</figcaption>
</figure>
</div>
</section>
<section id="testing" class="level3">
<h3 class="anchored" data-anchor-id="testing">Testing</h3>
<p>The code in <a href="#fig-Figure10_CodeForDampedSpringModel" class="quarto-xref">Figure&nbsp;<span>10</span></a> produces the following print and graphical output.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span>  <span class="fl">0.2203</span> <span class="op">+-</span>  <span class="fl">0.0024</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span>  <span class="fl">0.2084</span> <span class="op">+-</span> <span class="fl">0.0038</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>k <span class="op">=</span>  <span class="fl">18.662</span> <span class="op">+-</span>  <span class="fl">0.023</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>phi0 <span class="op">=</span>   <span class="fl">3.072</span> <span class="op">+-</span>  <span class="fl">0.011</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-Figure10_FitOfDampedSpringModelToData" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-Figure10_FitOfDampedSpringModelToData-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../..\chapters/Ch10/Figures/dampedSpringFitData.png" class="img-fluid figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Figure10_FitOfDampedSpringModelToData-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11: Graph of damped spring data and model function with best-fit parameters.
</figcaption>
</figure>
</div>
<p><a href="#fig-Figure10_FitOfDampedSpringModelToData" class="quarto-xref">Figure&nbsp;<span>11</span></a> shows a reasonable fit between the position data and the theoretical model, although there may be some bias in the theory towards lower position values. This might be due to the constant adjustment made on the position data to yield oscillations about <em>y = 0</em>. This could be easily tested by adjusting the constant used in line 31.</p>
</section>
</section>
<section id="ch10-exercises:sec" class="level2">
<h2 class="anchored" data-anchor-id="ch10-exercises:sec">Exercises</h2>
<p>1. Which statements below are true for the Least Squares Method for fitting data to a model?</p>
<ol type="a">
<li>It only applies to a model with one independent variable.</li>
<li>It allows more than one model parameter to be estimated at a time.</li>
<li>It involves minimizing the Least Squares Estimator Function.</li>
<li>It can only be used to fit data to a linear model.</li>
</ol>
<p>2. What is the calculus rule used to derive the least squares formulae for slope and intercept when fitting data to a linear model?</p>
<p>3. What is the name of the Python function that can perform a least squares fit of data to linear model?</p>
<p>4. What is the name of the Python function that can perform a least squares fit of data to nonlinear model?</p>
</section>
<section id="program-modification-problems" class="level2">
<h2 class="anchored" data-anchor-id="program-modification-problems">Program Modification Problems</h2>
<p>1. The Python program contained in Ch10ProgModProb1.py performs a linear regression (least-squares) fitting of some pressure versus temperature data for a gas held at constant volume. The data file for this program is GasData.txt.</p>
<p>The data file irisData.txt gives petal length and petal width measurements for many species of flower. You need to modify the Python code so that it performs a linear regression on this data. The program should also produce a plot of the data and the best-fit model. The graph should have</p>
<ul>
<li><p>proper axis labels</p></li>
<li><p>a legend that shows what is the model and what is the data</p></li>
<li><p>major gridlines</p></li>
</ul>
<p>The program should print out a message that gives</p>
<ul>
<li><p>best-fit values for model parameters</p></li>
<li><p>standard error for the slope</p></li>
<li><p>the <span class="math inline">\(R^2\)</span> value</p></li>
<li><p>the p-value for the fit</p></li>
</ul>
<p>2. The Python program contained in Ch10ProgModProb2.py performs a non-linear regression (least-squares) fitting of bacterial growth data to the exponential model. The data file for this program is bacterialGrowthData.txt . The program fits the exponential model to the bacteria grown in Cold Spring Harbor A + 0.1% glucose (CSHA) media. The file V_natriegensGrowthData.txt contains growth data for another bacteria species. You need to modify the Python code so that it performs a non-linear regression on this data using the logistics model function. The theoretical model function is</p>
<p><span class="math display">\[y\left(t\right) = \frac{My\left(0\right)e^{rt}}{M + y\left(0\right)(e^{rt}- 1)}\]</span></p>
<p>You can use the initial OD reading for <em>y(0)</em>, and then find the best-fit model parameters <em>M</em> and <em>r</em>. The program should also produce a plot of the data and the best-fit model. The graph should have</p>
<ul>
<li><p>proper axis labels</p></li>
<li><p>a legend that shows what is the model and what is the data</p></li>
<li><p>major gridlines</p></li>
</ul>
<p>The program should print out</p>
<ul>
<li><p>best-fit values for the model parameters</p></li>
<li><p>the standard error for the model parameter estimates</p></li>
</ul>
<p>3. The Python program contained in Ch10ProgModProb3.py performs a non-linear regression (least-squares) fitting of bacterial growth data to the exponential model using the numerical integration technique for obtaining the model function. The data file for this program is bacterialGrowthData.txt . The program fits the exponential model to the bacteria grown in Cold Spring Harbor A + 0.1% glucose (CSHA) media. The file V_natriegensGrowthData.txt contains growth data for another bacteria species. You need to modify the Python code so that it performs a non-linear regression on this data using the logistics model function obtained through the numerical integration technique. The theoretical rate equation is</p>
<p><span class="math display">\[\frac{dy\left(t\right)}{dt} = ry\left(1- \frac{y}{M}\right)\]</span></p>
<p>You can use the initial OD reading for <em>y(0)</em>, and then find the best-fit model parameters <em>M</em> and <em>r</em> using the least squares technique. The program should also produce a plot of the data and the best-fit model. The graph should have</p>
<ul>
<li><p>proper axis labels</p></li>
<li><p>a legend that shows what is the model and what is the data</p></li>
<li><p>major gridlines</p></li>
</ul>
<p>The program should print out</p>
<ul>
<li><p>best-fit values for the model parameters</p></li>
<li><p>the standard error for the model parameter estimates</p></li>
</ul>
<p>You should get the same final results as found in the Chapter 10 Program Modification Problem 2.</p>
</section>
<section id="ch10-program-development-problems:sec" class="level2">
<h2 class="anchored" data-anchor-id="ch10-program-development-problems:sec">Program Development Problems</h2>
<p>1. The following video shows a physics experiment where six bundled coffee filters are dropped from rest.</p>
<p><a href="https://youtu.be/muxKA3kK4IA" class="uri">https://youtu.be/muxKA3kK4IA</a></p>
<p>The mass of the six filters is mass = 5.3 [g]. The vertical position of the filters as a function of time was obtained from the video using video analysis software. The data is contained in the file coffeeFilterData.txt.</p>
<p>Your task is to develop a dynamical systems model for the coffee filter motion. Go through the steps of our general problem-solving strategy. Develop the model and implement its solution in Python code. Estimate any model parameters using least squares fitting of the model to the data. Include an estimate of uncertainty in the model parameter(s). You can assume the mass of the filters and the acceleration due to gravity are already known, so the only model parameter that must be estimated is the air drag coefficient, <em>k.</em> An air drag force proportional to the square of the velocity will probably work well for this problem.</p>
<p>The position data starts at a nonzero time value. It may simplify developing the model to adjust the times to start at zero by subtracting the constant initial time from each time value.</p>
<p>Add a plot of the constant acceleration model (just gravity) to the figure so that a comparison can be made between the simple theory and the more complex one that includes air drag.</p>
<p>Create a documentation essay that describes how you went through the problem-solving strategy, detailing each step. Make sure you include a plot of the data and the best fit to the model. Specify the best-fit values of the model parameters with uncertainty.</p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<div class="flushleft">
<p>Akritas, M. (2018). Chapter 6 Fitting Models to Data. In <em>Probability &amp; Statistics with R for Engineers and Scientists (Classic Version) (Pearson Modern Classics for Advanced Statistics Series)</em>. Pearson. http://www.librarything.com/work/17953304/book/228047240</p>
<p>Knight, R. (2016). Chapter 15 Oscillations. In <em>Physics for Scientists and Engineers: A Strategic Approach with Modern Physics</em> (4th edition). Pearson.</p>
<p>The SciPy Community. (2022a). <em>scipy.optimize.curve_fitâ€”SciPy v1.9.3 Manual</em>. https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.curve_fit.html</p>
<p>The SciPy Community. (2022b). <em>scipy.stats.linregressâ€”SciPy v1.9.3 Manual</em>. https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.linregress.html</p>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list" style="display: none">
<div id="ref-Akritas_Chapter6Fitting_2018" class="csl-entry" role="listitem">
Akritas, M. (2018). Chapter 6 <span>Fitting Models</span> to <span>Data</span>. In <em>Probability &amp; <span>Statistics</span> with <span>R</span> for <span>Engineers</span> and <span>Scientists</span> (<span>Classic Version</span>) (<span>Pearson Modern Classics</span> for <span>Advanced Statistics Series</span>)</em>. Pearson. <a href="http://www.librarything.com/work/17953304/book/228047240">http://www.librarything.com/work/17953304/book/228047240</a>
</div>
<div id="ref-Knight_Chapter15Oscillations_2016" class="csl-entry" role="listitem">
Knight, R. (2016). Chapter 15 <span>Oscillations</span>. In <em>Physics for <span>Scientists</span> and <span>Engineers</span>: <span>A Strategic Approach</span> with <span>Modern Physics</span></em> (4th edition). Pearson.
</div>
<div id="ref-TheSciPyCommunity_Scipyoptimizecurve_fitSciPyV193_2022" class="csl-entry" role="listitem">
The SciPy Community. (2022a). <em>Scipy.optimize.curve_fit â€” <span>SciPy</span> v1.9.3 <span>Manual</span></em>. <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.curve_fit.html">https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.curve_fit.html</a>
</div>
<div id="ref-TheSciPyCommunity_ScipystatslinregressSciPyV193_2022" class="csl-entry" role="listitem">
The SciPy Community. (2022b). <em>Scipy.stats.linregress â€” <span>SciPy</span> v1.9.3 <span>Manual</span></em>. <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.linregress.html">https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.linregress.html</a>
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../chapters/Ch09/Ch09_StochasticSimulations.html" class="pagination-link" aria-label="Stochastic Models and Simulations">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Stochastic Models and Simulations</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../chapters/Ch11/Ch11_Projects_DynamicalSystems.html" class="pagination-link" aria-label="Project Ideas: Dynamical Systems Models">
        <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Project Ideas: Dynamical Systems Models</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>